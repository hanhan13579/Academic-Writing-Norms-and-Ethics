
典型场景
（一）需求产生阶段
 用户在面对大量文本资料时，意识到需要快速准确地找到特定信息。例如，学生在准备论文写作，需要从众多学术文献中查找相关观点和数据；企业员工在处理项目时，要从公司知识库中获取操作流程、案例分析等文本。
（二）搜索发起阶段
-用户进入文本语义搜索界面，界面布局清晰，有明显的搜索框提示用户输入查询内容。用户输入自然语言描述的问题或关键词，如“项目 X 的成本控制方法”。
（三）搜索过程阶段
- 系统接收到用户输入后，迅速进行语义分析，理解用户意图。在文本库中进行全面检索，根据语义相关性对文本进行排序。同时，显示搜索进度条或提示信息，让用户知晓系统正在工作。
（四）结果呈现阶段
- 搜索结果以列表形式展示，包括文本标题、简要摘要等信息。文本按照相关性从高到低排列，方便用户快速浏览。例如，相关性得分高的文本排在前面，且文件名显示与搜索关键词匹配的部分。

目标竞品
被测对象分析
业务功能及使用场景
在文本语义搜索需求中，主要任务：文本语义搜索和摘要预览功能

文本语义搜索
文本语义搜索功能旨在通过理解用户查询的语义内容，提供与之高度相关的结果。在索引构建阶段，系统采用多维度策略，包括切片embedding、摘要embedding以及BM25索引，以确保全面捕捉文本的语义信息和关键词匹配，从而提升搜索的准确性和效率。​
1.切片embedding：将文本分割成多个片段，对每个片段进行embedding编码，存储为向量。这样，即使用户查询与文本的某一部分高度相关，也能通过片段的向量召回，实现精准匹配。​
2.摘要embedding：提取文本的关键信息生成摘要，并对其进行embedding编码。摘要embedding能够快速捕捉文本的核心内容，加速搜索过程，同时确保结果的相关性。​
3.BM25索引：构建基于关键词的倒排索引，利用BM25算法进行文本匹配。BM25算法考虑了词频、文本频率和文本长度等因素，能够有效处理关键词匹配，尤其在处理长文本和多义词时表现优异。​
在用户查询阶段，系统通过语义理解和关键词分析，同时利用上述三路召回机制结合重排序模型进行精排序，综合评估文本的相关性，最终返回最匹配的结果。这种多维度的搜索策略，不仅提升了搜索的语义理解能力，还兼顾了关键词的精确匹配，为用户提供更智能、更全面的搜索体验
文本语义搜索依靠智谱提供的LLM大模型实现业务上面的功能：
能够对用户Query进行提槽，识别主题、位置、时间和格式槽位，增加搜索的准确性。
能够对Query进行语义理解搜索。
支持范围举例：
1）帮我找一下C盘的关于人工智能的PDF文本
2）支持PDF\DOC\DOCX语义搜索
不支持范围举例：
不支持PPT\PPTX\XLSX进行语义搜索
不支持逻辑的或与非关系
文本语义搜索的操作流程以及结果呈现的UX设计如下：
根据文本语义搜索的能力，我们需要对文本语义搜索的功能点进行场景设计以及资料收集符合用户的实际使用场景，具体的测试流程如下：
用户文本数据建模—通过大数据和用户调研模拟用户的文本数据
Query语句建模—通过用研团队和大数据调研模型真实场景下用户的搜索行为
文本语义搜索测试 
摘要预览功能
使用搜索返回结果后，点击文本名称出现预览界面进行文本的摘要显示，文本摘要总结依靠智谱提供的能力以实现业务上面的功能：
端侧模型提取摘要效果达到云侧模型90%。
关键词的格式准确率不低于90%；
支持语言：中文、英文;
4、支持文本格式：pdf、docx、doc;
5、支持单篇最大字数1万字，摘要提取最少支持200字；
文本语义搜索预览摘要结果的操作流程以及结果呈现的UX设计如下：
根据文本摘要总结的能力，我们需要对文本摘要总结的功能点进行场景设计以及资料收集符合用户的实际使用场景，具体的测试流程如下：
用户文本数据建模——通过大数据和用户调研模拟用户的文本数据
文本摘要总结测试

特性架构设计与实现
AI能力全景图，其中五角星部分是开发文本语义搜索涉及到的部分。

文本语义搜索系统整体架构 
智慧搜索语义服务特性架构图主要分为两部分：索引构建过程和检索过程


由上图可得文本语义搜索在业务流程方面主要分为两个部分：
1． 索引构建部分：检测到文本发生变化（增加，修改，删除）后，索引构建任务进行继续然后解析文本基础信息解析，保存在文本基础信息数据库中。同时进行文本解析、文本切片构建BM25索引。并调用推理平台，加载模型进行BCE向量化形成向量化数据库。文本解析后会调用1.5B大模型生成摘要信息，保存在摘要数据库中。
2.	检索过程：用户输入提问的Query，然后进行Query提槽，提出时间，位置，主题和格式关键信息。使用主题词进行BM25索引召回，并调用BCE向量化模型进行切片/摘要和向量化召回，并使用原始Query基于提槽数据对召回的文本进行过滤，将多路召回结果重排序后，显示搜索结果在UX界面。
文本语义搜索索引构建处理流程方案
（1）文本预处理流程
在接收到由Abstract Plugin和AIDSearch Plugin通过GRPC转发的文本变更消息后，文本AI业务需对这些数据进行预处理，以确保信息的适用性。针对文本和文本语义搜索索引构建采取不同的预处理流程。以下介绍文本语义搜索索引构建的具体步骤概述。

1. 将AIDSearch Plugin发送的文本路径和状态转换为json格式
2. 通过json字段分析是否为新增，如果为新增则跳转第3步继续预处理操作，否则结束，执行删除语义搜索索引操作
3. 构建文本语义搜索任务队列，顺序执行任务
4. 根据文本格式(txt, docx, pdf)解析文本内容，并输出
以下介绍文本摘要提取的具体步骤概述。

将Abstract Plugin发送的文本路径和状态转换为json格式
通过json字段分析是否为新增，如果为新增则跳转第3步继续预处理操作，否则结束，执行删除摘要索引操作
构建文本摘要任务队列，顺序执行任务
根据文本格式(txt, docx, pdf)解析文本内容
将文本内容输入到风控模块判断文本内容是否符合安全规定，如果符合安全规定则跳转第6步，否则结束摘要提取
将文本文本输入数据清洗模块，将全角转为半角、删除异常字符、删除冗余字符，并将清洗后的数据进行输出
（2）语义搜索索引构建过程
1. 获取文本路径和文本状态
2. 判断文本状态：
  1. 如果文本状态为新增：
    1. 读取文本路径，获取文本内容，对文本内容进行切片，获取文本的若干片段
    2. 对切片后的片段进行清洗，如删除长度过短片段、去除特殊字符和url、删除数字和标点占比过多片段
    3. 对清洗后的片段使用BM25算法构建BM25索引
    4. 使用BCE embedding模型获取切片的embedding，用faiss索引工具构建embedding索引
  2. 如果文本状态为删除
    1. 调用BM25索引工具删除相应文本
    2. 调用faiss工具删除相应文本
  3. （如果文本状态为修改：先调用文本删除流程，然后调用文本新增流程）
在进行文本语义检索之前，必须进行索引的构建工作。当检测到本地PC文本的状态发生变化（如新增、修改或删除）时，相应的索引也需及时更新以确保检索的准确性和有效性。以下是索引构建流程：

（3）摘要索引构建过程
文本摘要生成的流程主要包括文本预处理、摘要生成和风控后处理、摘要存储及embedding步骤。首先，通过文本预处理对原始文本进行清洗和格式化，以去除噪声和无关信息。接着，利用预训练获得的摘要提取模型借由QNN推理模块提取摘要。最后，通过后处理步骤对生成的摘要进行风控处理并存入摘要数据库并保存其Embedding。整个流程旨在提高信息获取的效率，使用户能够快速理解文本的核心内容。

1. 根据文本AI业务预处理流程对原始文本进行清洗和格式化，去除噪声和无关信息，确保摘要生成的准确性。
2. 利用数据爬虫爬取50万条中英文语料对（来源arxiv，知乎及开源中文语料库等）。以MagicLM-3B-base模型作为底板模型进行模型微调，获得微调后的摘要提取模型
3. 利用预训练的摘要提取模型，通过QNN推理模块从处理后的文本中提取关键信息，生成摘要和关键词。
4. 利用风控模块对生成的摘要进行审核，确保内容的合规性和准确性，如果生成的内容安全则执行第5步，否则结束流程。
5. 将生成的摘要存储在摘要数据库中，并保存其Embedding到索引数据库，便于后续的信息检索和处理。
文本语义搜索检索处理流程方案
（1）Query提槽
query提槽模块针对用户搜索词提取出时间、盘符、文本格式、主题槽位，提槽方式为规则提槽。在AINLUService  Plugin已有的时间槽位提取完成之后，增加盘符和文本格式提槽，而主题信息为去除所有槽位信息后的内容，最后将结果同时发送给图片、视频、语音搜索，以及文本语义检索模块。

流程说明：
1. AIDSearch Plugin接收到用户搜索词信息
2. AINLUService  Plugin 获取时间提槽结果
3. AINLUService  Plugin进行盘符、文本格式提槽，并获取主题信息
4. AIDSearch Plugin等待提槽结果
  1. 等待超时：发送用户搜索词信息给AIDSearch
  2. 等待不超时：发送用户搜索词信息和提槽结果给AIDSearch
5. AIDSearch进行文本语义检索
6. 返回文本语义检索结果

（2）文本语义搜索推理处理流程(

1. 获取用户搜索词
2. 使用BCE embedding模型获取用户搜索词的embedding
3. 执行检索
  1. BM25召回：使用用户搜索词在BM25索引中获取检索结果，对结果进行槽位过滤
  2. 文本embedding召回：使用用户搜索词的embedding在文本切片embedding索引中获取检索结果，对结果进行槽位过滤
  3. 摘要embedding召回：使用用户搜索词的embedding在摘要embedding索引中获取检索结果，对结果进行槽位过滤
4. 对上面三路召回结果进行排序融合，并对每一路召回分配不同的权重
5. 返回文本语义检索结果

补充多路召回排序的结果
在使用用户搜索词进行检索时，使用了多路召回策略，并在召回后对多路召回的结果使用RRF算法进行重排序。
以下表格展示了多路召回的结果示例。例如：BM25召回分支召回三个切片，分别是[P3，P1，P2]，对应召回时的分时分别是[13.5，10.5，5.5]。同样的切片向量分支和摘要向量分支分别召回3个切片和2个切片。由于各支路召回切片时的评价标准不一致，所以在后续重排序时，不使用各自召回的分数。




召回结果重排序的目的是融合各召回支路的结果，使用统一的评价标准，将更相关的结果排在前面，从而提高用户的满意度和检索效率。此处使用的是倒数排序融合（RRF），它是一种将具有不同相关性指标的多个结果集组合成单个结果集的方法。 RRF 无需调优，不同的相关性指标也不必相互关联即可获得高质量的结果。该方法的优势在于不利用相关分数，而仅靠排名计算。其计算公式为：

针对每一个召回支路，通过使用不同的权重（切片0.5）来平衡不同召回支路对结果的影响。使用RRF计算P3的片段的RRF结果为：
RRF(P1)=0.5*(1/(60+3))+0.4*(1/(60+2))+0.1*(1/(60+1))=0.016027
RRF(P2)=0.5*(1/(60+2))+0.4*(1/(60+3))=0.014413
RRF(P3)=0.5*(1/(60+1))+0.4*(1/(60+1))+0.1*(1/(60+2))=0.016367
按照RRF分数结果排序后的召回切片结果为：[P3，P1，P2]
接下来将切片结果映射到文档标题上，针对召回结果中多个切片对应同一片文档，使用第一个出现的切片的位次作为文档召回的位次。例如：切片[P3，P1，P2]对应的文档分别是[DOC1，DOC2，DOC1]，则最终文档召回结果为[DOC1，DOC2]。



文本语义搜索使用了BCE Embeding模型和智谱1.5B摘要大模型的能力，针对采购的1.5B大模型需要对构建数据集进行能力测试。
TR点
业界方案




协议规范与认证（可选）
历史问题（必选）
智慧搜索存在的相关问题：
前向兼容性分析（必选）
合入的新特性对之前业务的影响的。
涉及的配置文件分析如下
最终形成测试规格纳入下表：
测试需求（TR）汇总清单
文本语义搜索方案测试需求汇总：
测试设计及用例生成
风险分析
TR-001 语义搜索功能测试需求分析
文本数据库测试集构建
大学生文本库：文本来源：来源知网和百度文库，论文类1155篇，行业报告211篇，个人材料826篇，共计2192篇。文本格式：格式分布PDF 1223篇，DOCX625篇，DOC261篇，TXT83篇。、
职场办公人群文本库：来源百度文库，共计404篇，其中职场办公人群占比47.28%。覆盖用研调研的职业、学科和文本类型。




      （2）摘要文本测试库，使用文本库中的所有文本进行摘要格式测试。对于效果评测，使用763篇文本，其中个人材料339篇，论文知识库424篇，并使用云侧大模型（通义千问2.0）对个人材料文本生成相应的摘要，论文采取相应的原始文本摘要。

（3）文本语义搜索Query提槽测试数据集

（4）文本语义搜索端到端测试数据集

文本语义搜索功能测试需求分析
3.2.2.1 场景分析-E2E场景分析



(1)使用Pairwise生成功能测试用例组合

对应生成的用例如下：
3.2.2.2 搜索结果分析—判定表分析方法
针对风险点关键词搜索结果和语义搜索结果界面显示以及结果返回的，进行判定表分析输出相应的测试用例。
条件 ：关键字索引是否构建 语义索引是否构建 query是否相关 
操作： 是否有关键词搜索结果 是否有语义搜索结果


生成对应的用例


3.2.2.3 文件信息构建—等价类测试方法   2007  2018
版本 


3.2.2.4 Query提槽测试—正交测试方法
用户输入的Query将经过位置、主题、格式和时间四个槽位的提取，进行语义检索和召回。具体设计如下：
位置槽位：识别Query中包含的地理或设备位置信息。
主题槽位：提取Query中的核心主题关键词，帮助理解用户意图。
格式槽位：分析用户输入的格式，适应不同的输入方式（如自然语言、关键词等）。
时间槽位：识别Query中涉及的时间信息，以支持时间相关的检索。
依据大数据和用研输入 
因子组合情况如下，将上述因子取值进行正交组合。
3.2.2.5 用户场景分析—流程图测试分析方法
流程图法：用流程图的方式去展现基于用户使用场景，覆盖用户操作的每一条路径形成测试用例，用户存在 微信传递、浏览器下载、新建文档以及U盘拷贝文件动作后构建索引后进行搜索动作。

3.2.2.6 异常场景分析法
1. 大量文档（2000+）U盘拷贝场景   影响磁盘占用1T
2. 索引库被删除场景    
3. 模型被删除场景
4. 显卡掉卡场景
5. 语义搜索相关进程崩溃
6.索引构建时被中断（异常开关机）的场景  



TR-002 语义搜索配置测试需求分析
TR-003语义搜索DFX测试需求分析


TR-004语义搜索性能测试需求分析
TR-005语义搜索功耗测试需求分析
TR-006语义搜索稳定性测试需求分析
TR-007语义搜索隐私协议测试需求分析
TR-008语义搜索安全测试需求分析
TR-009语义搜索兼容性测试需求分析
TR-010语义搜索Beta和大数据看板测试需求分析
本部分通过Beta众测任务和实验室众测任务进行测试，主要通过语义搜索的使用率衡量业务的价值。同时对DFX打点进行看板设计，进行方案的监控。

场景基线测试设计
用户场景基线分析
场景影响因子分析（必选）






KEP分析设计
识别关键体验路径：
针对每个场景，识别出用户在使用文本语义搜索时的关键体验路径。例如：
用户输入查询 → 系统返回结果 → 用户浏览结果 → 用户选择文本 → 用户获取信息
定义关键体验指标（KEI）：
为每个关键体验路径定义相应的指标，以评估用户体验。
1、搜索准确性：返回结果与用户期望的匹配程度。
2、响应时间：系统返回结果所需的时间。
3、用户满意度：用户对搜索结果的满意程度。
以大数据，舆情，痛点等作为基础，结合文本语义搜索的场景，综合分析，构建KEP。（补充构建输入）
因子取值与组合分析（必选）
用户场景体验指标分析   
	将4.1.2分析输出的典型用户场景进行汇总，然后对每一个用户场景，分别从性能、效果、能耗、功能完备性、规则五个维度设计场景体验指标用于用户场景的质量评估。
体验要素分析（必选）
体验指标分析（必选）
关键指标分析（必选）
测试标准分析（必选）
可测试性设计（可选）
暂不补充
针对客观指标中需要使用特殊测试方法、测试工具及大数据的，识别可测试性需求，如音频测试工具、网络测试工具、车机测试套、数据打点、数据监控等
Ps：大数据指标可分为公共指标和特有指标，具体请参考KQI大数据设计指导书（王腾的设计方案）。

附录
第一次评审讨论主要问题闭环

